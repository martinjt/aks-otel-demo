mode: daemonset
nameOverride: collector
resources:
  limits:
    cpu: 1
    memory: 1Gi
presets:
  hostMetrics:
    enabled: true
  kubernetesAttributes:
    enabled: true
service:
  type: ClusterIP
  enabled: true
image:
  tag: "0.81.0"
config:
  receivers:
    otlp:
      protocols:
        grpc:
        http:
          cors:
            allowed_origins:
              - http://*
              - https://*
          endpoint: 0.0.0.0:4318
  processors:
    transform:
      metric_statements:
        - context: metric
          statements:
            - set(description, "Measures the duration of inbound HTTP requests") where name == "http.server.duration"
    filter/ottl:
      error_mode: ignore
      metrics:
        metric:
          - 'name == "queueSize"'

  exporters:
    otlp:
      endpoint: ${REFINERY_ADDRESS}:4317
      headers:
        x-honeycomb-team: ${HONEYCOMB_API_KEY}
      tls:
        insecure: true

    otlp/metrics:
      endpoint: api.honeycomb.io:443
      headers:
        x-honeycomb-team: ${HONEYCOMB_API_KEY}
        x-honeycomb-dataset: service-metrics

    otlp/logging:
      endpoint: api.honeycomb.io:443
      headers:
        x-honeycomb-team: ${HONEYCOMB_API_KEY}
        x-honeycomb-dataset: service-logs

  service:
    pipelines:
      metrics: 
        exporters: [otlp/metrics]
      logs: 
        exporters: [otlp/logging]
      traces:
        exporters: [otlp]